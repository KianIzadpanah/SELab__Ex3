# مدیریت حساب بانکی

## بخش اول: کشف خطا

### پرسش اول

در برنامۀ مدیریت حساب بانکی، کلاسی به نام AccountBalanceCalculator تعریف شده است که وظیفۀ محاسبۀ موجودی نهایی حساب را بر اساس لیستی از تراکنش ها دارد. این کلاس همچنین دارای یک لیست استاتیک از تاریخچۀ تراکنش‌ها می‌باشد. در پیاده‌سازی اولیه، متد calculateBalance فقط عملیات محاسبه را انجام می‌داد و هیچ تغییری در transactionHistory نمی‌داد؛ بنابراین، تاریخچه‌ی تراکنش‌ها پس از محاسبه خالی یا نامربوط باقی می‌ماند.

دلیل اصلی چنین نقصی، این است که تست‌های قبلی فقط مقدار نهایی موجودی (balance) را بررسی می‌کردند و هیچ‌کدام بررسی نمی‌کردند که آیا تاریخچۀ تراکنش‌ها به‌درستی پس از محاسبه ذخیره شده است یا نه.

برای مثال، تست‌هایی مانند testOnlyDeposits یا testMixedTransactions فقط مقدار خروجی متد calculateBalance را ارزیابی می‌کنند و کاری به محتویات getTransactionHistory() ندارند.

حتی تست‌هایی که به تاریخچه مربوط بودند (مثل testTransactionHistoryShouldBeEmptyBeforeCalculatingBalance) صرفاً وضعیت قبل از محاسبه را بررسی می‌کردند و نه بعد از آن. در نتیجه، چون بررسی صریحی برای محتوای تاریخچه پس از محاسبه وجود نداشت، این نقص عملکردی توسط تست‌ها شناسایی نشده بود. در تصویر زیر پاس شدن تمامی تست ها با وجود چنین اشکالی را می توانیم مشاهده کنیم:
![](./images/1.png)

---

### پرسش دوم

جهت بررسی صحت رفتار مورد انتظار، تست زیر نوشته شد:
![](./images/2.png)

هدف این تست آن است که بررسی کند آیا پس از فراخوانی calculateBalance، تاریخچۀ تراکنش‌ها به درستی با ورودی مطابقت دارد یا خیر. قبل از اعمال تغییرات، اجرای این تست با شکست مواجه شد که نشان داد برنامه رفتار مورد انتظار را ندارد و تاریخچه به‌روز نمی‌شود. این شکست در تصویر زیر قابل مشاهده است:
![](./images/3.png)

برای رفع مشکل، کد متد calculateBalance به صورت زیر اصلاح شد:
![](./images/4.png)

با این تغییر، همه‌ی تست‌ها، از جمله تست جدید اضافه‌شده، با موفقیت اجرا شدند. این نشان‌دهندۀ صحت عملکرد و اصلاح درست باگ بود. این اجرای موفقیت آمیز در تصویر زیر قابل مشاهده است:
![](./images/5.png)
